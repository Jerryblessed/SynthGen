{% extends "base.html" %}
{% block title %}Generate Data{% endblock %}
{% block content %}

{% if is_guest %}
<div class='alert alert-info'>
    <strong>ℹ️ Guest Mode:</strong> You're using the app as a guest. 
    <a href="{{ url_for('login') }}" class='alert-link'>Login</a> to save and view your generated data permanently.
</div>
{% endif %}

{% if error_message %}
<div class='alert alert-danger'>
    <strong>Error:</strong> {{ error_message }}
</div>
{% endif %}

<div class='row'>
    <div class='col-md-8'>
        <h2>🧪 Generate Synthetic Data</h2>
        <form method='post' enctype='multipart/form-data'>
            <div class='mb-3'><label for="file" class="form-label">📄 CSV Schema (Header only)</label><input type='file' id="file" name='file' class='form-control' required></div>
            <div class='mb-3'><label for="domain" class="form-label">📊 Domain</label><select id="domain" name='domain' class='form-select'><option>health</option><option>finance</option><option>retail</option></select></div>
            <div class='mb-3'><label for="cs" class="form-label">🔢 Records: <span id='c'>100</span></label><input type='range' id='cs' name='count' min='1' max='1000' value='100' class='form-range'></div>
            <div class='mb-3'><label for="ns" class="form-label">🎲 Noise: <span id='n'>0.1</span></label><input type='range' id='ns' name='noise' min='0' max='1' step='0.01' value='0.1' class='form-range'></div>
            <div class='form-check mb-3'><input class='form-check-input' type='checkbox' name='balance' id="balance"><label class='form-check-label' for="balance">⚖️ Balance Classes</label></div>
            <div class='form-check mb-3'><input class='form-check-input' type='checkbox' name='mask_pii' id="mask_pii"><label class='form-check-label' for="mask_pii">🔒 Mask PII</label></div>
            <button class='btn btn-success'>🚀 Generate</button>
        </form>

        {% if record_id %}
        <hr>
        <div class="alert alert-success">
            Data generated successfully! <a class='btn btn-primary btn-sm' href="{{ url_for('download', rid=record_id) }}">⬇️ Download Full CSV</a>
        </div>
        <h4>Preview:</h4>
        <pre class='mt-3 bg-light p-2 border rounded'><code>{{ preview }}</code></pre>
        {% endif %}
        
    </div>

    <div class='col-md-4'>
        <div class='card'>
            <div class='card-header bg-info text-white'>🧠 AI Agent Assistant</div>
            <div class='card-body'>
                <p>Having trouble? Ask the agent for help.</p>
                <form action="{{ url_for('agent') }}" method='post'>
                    <label for="agent_query">Ask Anything:</label>
                    <textarea id="agent_query" name='query' class='form-control mb-2' required></textarea>
                    <button class='btn btn-outline-primary w-100'>Ask Agent</button>
                </form>
                <div class='mt-3'><strong>❓ Examples:</strong>
                    <ul class='small'>
                        <li>Generate 100 finance records</li>
                        <li>What does noise mean?</li>
                        <li>How to mask PII?</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.getElementById('cs').oninput = e => document.getElementById('c').innerText = e.target.value;
    document.getElementById('ns').oninput = e => document.getElementById('n').innerText = e.target.value;
</script>
{% endblock %}